<div class="container">
  <div class="order-detail-container">
    <app-loading-spinner *ngIf="loading"></app-loading-spinner>

    <div *ngIf="error" class="alert alert-error">{{ error }}</div>

    <div *ngIf="!loading && order">
      <div class="order-header">
        <div>
          <h1>Order #{{ order.orderNumber }}</h1>
          <p class="order-date">Placed on {{ order.createdAt | date:'full' }}</p>
        </div>
        <span class="order-status" [ngClass]="getStatusClass(order.status)">
          {{ order.status }}
        </span>
      </div>

      <div class="order-content">
        <div class="order-main">
          <div class="card">
            <div class="card-header">
              <h2>Order Items</h2>
            </div>

            <div class="items-list">
              <div *ngFor="let item of order.items" class="order-item">
                <div class="item-info">
                  <h3>{{ item.productName }}</h3>
                  <p>SKU: {{ item.productSku }}</p>
                  <p>Quantity: {{ item.quantity }}</p>
                </div>
                <div class="item-pricing">
                  <p class="unit-price">${{ item.unitPrice.toFixed(2) }} each</p>
                  <p class="total-price">${{ (item.unitPrice * item.quantity).toFixed(2) }}</p>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Shipping Information</h2>
            </div>
            <p>{{ order.shippingAddress }}</p>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Billing Information</h2>
            </div>
            <p>{{ order.billingAddress }}</p>
          </div>

          <div class="card" *ngIf="payments.length > 0">
            <div class="card-header">
              <h2>Payment Information</h2>
            </div>
            <div *ngFor="let payment of payments">
              <p><strong>Transaction ID:</strong> {{ payment.transactionId }}</p>
              <p><strong>Method:</strong> {{ payment.paymentMethod.replace('_', ' ') }}</p>
              <p><strong>Status:</strong> {{ payment.status }}</p>
              <p><strong>Amount:</strong> ${{ payment.amount.toFixed(2) }}</p>
            </div>
          </div>
        </div>

        <div class="order-sidebar">
          <div class="card">
            <div class="card-header">
              <h2>Order Summary</h2>
            </div>

            <div class="summary-row">
              <span>Subtotal:</span>
              <span>${{ (order.totalAmount - order.taxAmount - order.shippingAmount).toFixed(2) }}</span>
            </div>

            <div class="summary-row">
              <span>Shipping:</span>
              <span>${{ order.shippingAmount.toFixed(2) }}</span>
            </div>

            <div class="summary-row">
              <span>Tax:</span>
              <span>${{ order.taxAmount.toFixed(2) }}</span>
            </div>

            <div class="summary-row total">
              <span>Total:</span>
              <span>${{ order.totalAmount.toFixed(2) }}</span>
            </div>

            <button 
              *ngIf="canCancelOrder()" 
              class="btn btn-danger btn-block mt-2" 
              (click)="cancelOrder()"
            >
              Cancel Order
            </button>

            <button class="btn btn-secondary btn-block mt-2" routerLink="/orders">
              Back to Orders
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
